<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>How to run SpeedyWeather.jl · SpeedyWeather.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li class="is-active"><a class="tocitem" href>How to run SpeedyWeather.jl</a><ul class="internal"><li><a class="tocitem" href="#Example-1:-2D-turbulence-on-a-non-rotating-sphere"><span>Example 1: 2D turbulence on a non-rotating sphere</span></a></li><li><a class="tocitem" href="#Example-2:-Shallow-water-with-mountains"><span>Example 2: Shallow water with mountains</span></a></li><li><a class="tocitem" href="#SpectralGrid"><span>SpectralGrid</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../spectral_transform/">Spherical harmonic transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li><li><a class="tocitem" href="../dynamical_core/">Dynamical core</a></li><li><a class="tocitem" href="../parametrizations/">Parameterizations</a></li><li><a class="tocitem" href="../boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../extending/">Extending SpeedyWeather</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li><li><a class="tocitem" href="../ringgrids/">Submodule: RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">Submodule: LowerTriangularMatrices</a></li><li><a class="tocitem" href="../speedytransforms/">Submodule: SpeedyTransforms</a></li><li><a class="tocitem" href="../functions/">Function and type index</a></li><li><a class="tocitem" href="../conventions/">Style and convention guide</a></li><li><a class="tocitem" href="../development/">Development notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>How to run SpeedyWeather.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>How to run SpeedyWeather.jl</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/how_to_run_speedy.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="How-to-run-SpeedyWeather.jl"><a class="docs-heading-anchor" href="#How-to-run-SpeedyWeather.jl">How to run SpeedyWeather.jl</a><a id="How-to-run-SpeedyWeather.jl-1"></a><a class="docs-heading-anchor-permalink" href="#How-to-run-SpeedyWeather.jl" title="Permalink"></a></h1><p>Creating a SpeedyWeather.jl simulation and running it consists conceptually of 4 steps</p><ol><li>Create a <code>SpectralGrid</code> which defines the grid and spectral resolution</li><li>Create a model</li><li>Initialize a model to obtain a <code>Simulation</code>.</li><li>Run the simulation.</li></ol><p>In the following we will describe these steps in more detail, but let&#39;s start with some examples first.</p><h2 id="Example-1:-2D-turbulence-on-a-non-rotating-sphere"><a class="docs-heading-anchor" href="#Example-1:-2D-turbulence-on-a-non-rotating-sphere">Example 1: 2D turbulence on a non-rotating sphere</a><a id="Example-1:-2D-turbulence-on-a-non-rotating-sphere-1"></a><a class="docs-heading-anchor-permalink" href="#Example-1:-2D-turbulence-on-a-non-rotating-sphere" title="Permalink"></a></h2><p>We want to use the barotropic model to simulate some free-decaying 2D turbulence on the sphere without rotation. We start by defining the <code>SpectralGrid</code> object. To have a resolution of about 100km, we choose a spectral resolution of T127 (see <a href="@ref">Available resolutions</a>) and <code>nlev=1</code> vertical levels. The <code>SpectralGrid</code> object will provide us with some more information</p><pre><code class="language-julia hljs">julia&gt; spectral_grid = SpectralGrid(trunc=127,nlev=1)
SpectralGrid:
 Spectral:   T127 LowerTriangularMatrix{Complex{Float32}}, radius = 6.371e6 m
 Grid:       40320-element, 192-ring OctahedralGaussianGrid{Float32} (quadratic)
 Resolution: 112km (average)
 Vertical:   1-level SigmaCoordinates</code></pre><p>We could have specified further options, but let&#39;s ignore that for now. Next step we create a planet that&#39;s like Earth but not rotating</p><pre><code class="language-julia hljs">julia&gt; still_earth = Earth(rotation=0)
Main.SpeedyWeather.Earth
  rotation: Float64 0.0
  gravity: Float64 9.81
  daily_cycle: Bool true
  length_of_day: Float64 24.0
  seasonal_cycle: Bool true
  length_of_year: Float64 365.25
  equinox: Dates.DateTime
  axial_tilt: Float64 23.4</code></pre><p>There are other options to create a planet but they are irrelevant for the barotropic vorticity equations. We also want to specify the initial conditions, randomly distributed vorticity is already defined</p><pre><code class="language-julia hljs">julia&gt; initial_conditions = StartWithRandomVorticity()
StartWithRandomVorticity
  power_law: Float64 -3.0
  amplitude: Float64 1.0e-5</code></pre><p>By default, the power of vorticity is spectrally distributed with <span>$k^{-3}$</span>, <span>$k$</span> being the horizontal wavenumber, and the amplitude is <span>$10^{-5}\text{ s}^{-1}$</span>.</p><p>Now we want to construct a <code>BarotropicModel</code> with these</p><pre><code class="language-julia hljs">julia&gt; model = BarotropicModel(;spectral_grid, initial_conditions, planet=still_earth);</code></pre><p>The <code>model</code> contains all the parameters, but isn&#39;t initialized yet, which we can do with and then run it.</p><pre><code class="language-julia hljs">julia&gt; simulation = initialize!(model);
julia&gt; run!(simulation,n_days=30)</code></pre><p>The <code>run!</code> command will always return the prognostic variables, which, by default, are  plotted for surface relative vorticity with a unicode plot. The resolution of the plot is not necessarily representative but it lets us have a quick look at the result</p><p><img src="https://raw.githubusercontent.com/SpeedyWeather/SpeedyWeather.jl/main/docs/img/barotropic_vorticity.jpg" alt="Barotropic vorticity unicode plot"/></p><p>Woohoo! I can see turbulence! You could pick up where this simulation stopped by simply doing <code>run!(simulation,n_days=50)</code> again. We didn&#39;t store any output, which you can do by <code>run!(simulation,output=true)</code>, which will switch on NetCDF output with default settings. More options on output in <a href="../output/#NetCDF-output">NetCDF output</a>.</p><h2 id="Example-2:-Shallow-water-with-mountains"><a class="docs-heading-anchor" href="#Example-2:-Shallow-water-with-mountains">Example 2: Shallow water with mountains</a><a id="Example-2:-Shallow-water-with-mountains-1"></a><a class="docs-heading-anchor-permalink" href="#Example-2:-Shallow-water-with-mountains" title="Permalink"></a></h2><p>As a second example, let&#39;s investigate the Galewsky et al.<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> test case for the shallow water equations with and without mountains. As the shallow water system has also only one level, we can reuse the <code>SpectralGrid</code> from Example 1.</p><pre><code class="language-julia hljs">julia&gt; spectral_grid = SpectralGrid(trunc=127,nlev=1)</code></pre><p>Now as a first simulation, we want to disable any orography, so we create a <code>NoOrography</code></p><pre><code class="language-julia hljs">julia&gt; orography = NoOrography(spectral_grid)
NoOrography{Float32, OctahedralGaussianGrid{Float32}}</code></pre><p>Although the orography is zero, you have to pass on <code>spectral_grid</code> so that it can still initialize zero-arrays of the right size and element type. Awesome. This time the initial conditions should be set the the Galewsky et al.<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> zonal jet, which is already defined as</p><pre><code class="language-julia hljs">julia&gt; initial_conditions = ZonalJet()
ZonalJet
  latitude: Float64 45.0
  width: Float64 19.28571428571429
  umax: Float64 80.0
  perturb_lat: Float64 45.0
  perturb_lon: Float64 270.0
  perturb_xwidth: Float64 19.098593171027442
  perturb_ywidth: Float64 3.819718634205488
  perturb_height: Float64 120.0</code></pre><p>The jet sits at 45˚N with a maximum velocity of 80m/s and a perturbation as described in their paper. Now we construct a model, but this time a <code>ShallowWaterModel</code></p><pre><code class="nohighlight hljs">julia&gt; model = ShallowWaterModel(;spectral_grid, orography, initial_conditions);
julia&gt; simulation = initialize!(model);</code></pre><p><img src="https://raw.githubusercontent.com/SpeedyWeather/SpeedyWeather.jl/main/docs/img/galewsky.jpg" alt="Galewsky jet unicode plot"/></p><p>Oh yeah. That looks like the wobbly jet in their paper. Let&#39;s run it again for another 6 days but this time also store <a href="../output/#NetCDF-output">NetCDF output</a>.</p><pre><code class="nohighlight hljs">julia&gt; run!(simulation,n_days=6,output=true)
Weather is speedy: run 0002 100%|███████████████████████| Time: 0:00:12 (115.37 years/day)</code></pre><p>The progress bar tells us that the simulation run got the identification &quot;0002&quot;, meaning that data is stored in the folder <code>/run_0002</code>, so let&#39;s plot that data properly (and not just using UnicodePlots).</p><pre><code class="language-julia hljs">julia&gt; using PyPlot, NCDatasets
julia&gt; ds = NCDataset(&quot;run_0002/output.nc&quot;);
julia&gt; ds[&quot;vor&quot;]
vor (384 × 192 × 1 × 25)
  Datatype:    Float32
  Dimensions:  lon × lat × lev × time
  Attributes:
   units                = 1/s
   missing_value        = NaN
   long_name            = relative vorticity
   _FillValue           = NaN</code></pre><p>Vorticity <code>vor</code> is stored as a 384x192x1x25 array, we may want to look at the first time step, which is the end of the previous simulation (time=6days) which we didn&#39;t store output for.</p><pre><code class="language-julia hljs">julia&gt; vor = ds[&quot;vor&quot;][:,:,1,1];
julia&gt; lat = ds[&quot;lat&quot;][:];
julia&gt; lon = ds[&quot;lon&quot;][:];
julia&gt; pcolormesh(lon,lat,vor&#39;)</code></pre><p>Which looks like</p><p><img src="https://raw.githubusercontent.com/SpeedyWeather/SpeedyWeather.jl/main/docs/img/galewsky_nc_6days.png" alt="Galewsky jet pyplot"/></p><p>You see that the unicode plot heavily coarse-grains the simulation, well it&#39;s unicode after all! And now the last time step, that means time=12days is</p><pre><code class="language-julia hljs">julia&gt; vor = ds[&quot;vor&quot;][:,:,1,25];
julia&gt; pcolormesh(lon,lat,vor&#39;)</code></pre><p><img src="https://raw.githubusercontent.com/SpeedyWeather/SpeedyWeather.jl/main/docs/img/galewsky_nc_12days.png" alt="Galewsky jet pyplot"/></p><p>The jet broke up into many small eddies, but the turbulence is still confined to the northern hemisphere, cool! How this may change when we add mountains (we had <code>NoOrography</code> above!), say Earth&#39;s orography, you may ask? Let&#39;s try it out! We create an <code>EarthOrography</code> struct like so</p><pre><code class="language-julia hljs">julia&gt; orography = EarthOrography(spectral_grid)
EarthOrography{Float32, OctahedralGaussianGrid{Float32}}:
 path::String = SpeedyWeather.jl/input_data
 file::String = orography_F512.nc
 scale::Float64 = 1.0
 smoothing::Bool = true
 smoothing_power::Float64 = 1.0
 smoothing_strength::Float64 = 0.1
 smoothing_truncation::Int64 = 85</code></pre><p>It will read the orography from file as shown, and there are some smoothing options too, but let&#39;s not change them. Same as before, create a model, initialize into a simulation, run. This time directly for 12 days so that we can compare with the last plot</p><pre><code class="language-julia hljs">julia&gt; model = ShallowWaterModel(;spectral_grid, orography, initial_conditions);
julia&gt; simulation = initialize!(model);
julia&gt; run!(simulation,n_days=12,output=true)
Weather is speedy: run 0003 100%|███████████████████████| Time: 0:00:35 (79.16 years/day)</code></pre><p>This time the run got the id &quot;0003&quot;, but otherwise we do as before.</p><p><img src="https://raw.githubusercontent.com/SpeedyWeather/SpeedyWeather.jl/main/docs/img/galewsky_nc_12days_mountains.png" alt="Galewsky jet pyplot"/></p><p>Interesting! The initial conditions have zero velocity in the southern hemisphere, but still, one can see some imprint of the orography on vorticity. You can spot the coastline of Antarctica; the Andes and Greenland are somewhat visible too. Mountains also completely changed the flow after 12 days, probably not surprising!</p><h2 id="SpectralGrid"><a class="docs-heading-anchor" href="#SpectralGrid">SpectralGrid</a><a id="SpectralGrid-1"></a><a class="docs-heading-anchor-permalink" href="#SpectralGrid" title="Permalink"></a></h2><p>The life of every SpeedyWeather.jl simulation starts with a <code>SpectralGrid</code> object. We have seen some examples above, now let&#39;s look into the details</p><article class="docstring"><header><a class="docstring-binding" id="SpeedyWeather.SpectralGrid" href="#SpeedyWeather.SpectralGrid"><code>SpeedyWeather.SpectralGrid</code></a> — <span class="docstring-category">Type</span></header><section><div><p>Defines the horizontal spectral resolution and corresponding grid and the vertical coordinate for SpeedyWeather.jl. Options are</p><ul><li><p><code>NF::Type{&lt;:AbstractFloat}</code>: number format used throughout the model</p></li><li><p><code>trunc::Int64</code>: horizontal resolution as the maximum degree of spherical harmonics</p></li><li><p><code>Grid::Type{&lt;:SpeedyWeather.RingGrids.AbstractGrid}</code>: horizontal grid used for calculations in grid-point space</p></li><li><p><code>dealiasing::Float64</code>: how to match spectral with grid resolution: dealiasing factor, 1=linear, 2=quadratic, 3=cubic grid</p></li><li><p><code>radius::Float64</code>: radius of the sphere [m]</p></li><li><p><code>nlat_half::Int64</code>: number of latitude rings on one hemisphere (Equator incl)</p></li><li><p><code>npoints::Int64</code>: total number of grid points in the horizontal</p></li><li><p><code>nlev::Int64</code>: number of vertical levels</p></li><li><p><code>vertical_coordinates::SpeedyWeather.VerticalCoordinates</code>: coordinates used to discretize the vertical</p></li></ul><p><code>nlat_half</code> and <code>npoints</code> should not be chosen but are derived from <code>trunc</code>, <code>Grid</code> and <code>dealiasing</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/60e0d44a3cc58d44c13a12e8bca431f4473d9857/src/dynamics/spectral_grid.jl#L5-L11">source</a></section></article><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><p><sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> Galewsky, Scott, Polvani, 2004. <em>An initial-value problem for testing numerical models of the global shallow-water equations</em>, Tellus A. DOI: <a href="https://doi.org/10.3402/tellusa.v56i5.14436">10.3402/tellusa.v56i5.14436</a></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../installation/">« Installation</a><a class="docs-footer-nextpage" href="../spectral_transform/">Spherical harmonic transform »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Saturday 10 June 2023 21:18">Saturday 10 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
