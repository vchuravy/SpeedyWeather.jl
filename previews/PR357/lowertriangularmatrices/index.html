<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Submodule: LowerTriangularMatrices · SpeedyWeather.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather.jl</a></li><li><a class="tocitem" href="../spectral_transform/">Spherical harmonic transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li><li><a class="tocitem" href="../dynamical_core/">Dynamical core</a></li><li><a class="tocitem" href="../parametrizations/">Parameterizations</a></li><li><a class="tocitem" href="../boundary_conditions/">Boundary conditions</a></li><li><a class="tocitem" href="../extending/">Extending SpeedyWeather</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li><li><a class="tocitem" href="../ringgrids/">Submodule: RingGrids</a></li><li class="is-active"><a class="tocitem" href>Submodule: LowerTriangularMatrices</a><ul class="internal"><li><a class="tocitem" href="#Creation-of-LowerTriangularMatrix"><span>Creation of <code>LowerTriangularMatrix</code></span></a></li><li><a class="tocitem" href="#Indexing-LowerTriangularMatrix"><span>Indexing <code>LowerTriangularMatrix</code></span></a></li><li><a class="tocitem" href="#Linear-algebra-with-LowerTriangularMatrix"><span>Linear algebra with <code>LowerTriangularMatrix</code></span></a></li><li><a class="tocitem" href="#Function-index"><span>Function index</span></a></li></ul></li><li><a class="tocitem" href="../speedytransforms/">Submodule: SpeedyTransforms</a></li><li><a class="tocitem" href="../functions/">Function and type index</a></li><li><a class="tocitem" href="../conventions/">Style and convention guide</a></li><li><a class="tocitem" href="../development/">Development notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Submodule: LowerTriangularMatrices</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Submodule: LowerTriangularMatrices</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/lowertriangularmatrices.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="LowerTriangularMatrices"><a class="docs-heading-anchor" href="#LowerTriangularMatrices">LowerTriangularMatrices</a><a id="LowerTriangularMatrices-1"></a><a class="docs-heading-anchor-permalink" href="#LowerTriangularMatrices" title="Permalink"></a></h1><p>LowerTriangularMatrices is a submodule that has been developed for SpeedyWeather.jl which is technically independent (SpeedyWeather.jl however imports it and so does SpeedyTransforms) and can also be used without running simulations. It is just not put into its own respective repository.</p><p>This module defines <code>LowerTriangularMatrix</code>, a lower triangular matrix, which in contrast to <a href="https://docs.julialang.org/en/v1/stdlib/LinearAlgebra/#LinearAlgebra.LowerTriangular"><code>LinearAlgebra.LowerTriangular</code></a> does not store the entries above the diagonal. SpeedyWeather.jl uses <code>LowerTriangularMatrix</code> which is defined as a subtype of <code>AbstractMatrix</code> to store the spherical harmonic coefficients (see <a href="../spectral_transform/#Spectral-packing">Spectral packing</a>). </p><h2 id="Creation-of-LowerTriangularMatrix"><a class="docs-heading-anchor" href="#Creation-of-LowerTriangularMatrix">Creation of <code>LowerTriangularMatrix</code></a><a id="Creation-of-LowerTriangularMatrix-1"></a><a class="docs-heading-anchor-permalink" href="#Creation-of-LowerTriangularMatrix" title="Permalink"></a></h2><p>A <code>LowerTriangularMatrix</code> can be created using <code>zeros</code>,<code>ones</code>,<code>rand</code>, or <code>randn</code></p><pre><code class="language-julia hljs">julia&gt; using SpeedyWeather.LowerTriangularMatrices

julia&gt; L = rand(LowerTriangularMatrix{Float32},5,5)
5×5 LowerTriangularMatrix{Float32}:
 0.912744   0.0        0.0       0.0       0.0
 0.0737592  0.230592   0.0       0.0       0.0
 0.799679   0.0765255  0.888098  0.0       0.0
 0.670835   0.997938   0.505276  0.492966  0.0
 0.949321   0.193692   0.793623  0.152817  0.357968</code></pre><p>or the <code>undef</code> initializor <code>LowerTriangularMatrix{Float32}(undef,3,3)</code>. The element type is arbitrary though, you can use any type <code>T</code> too.</p><p>Alternatively, it can be created through conversion from <code>Matrix</code>, which drops the upper triangle entries and sets them to zero</p><pre><code class="language-julia hljs">julia&gt; M = rand(Float16,3,3)
3×3 Matrix{Float16}:
 0.2222  0.694    0.3452
 0.2158  0.04443  0.274
 0.9746  0.793    0.6294

julia&gt; LowerTriangularMatrix(M)
3×3 LowerTriangularMatrix{Float16}:
 0.2222  0.0      0.0
 0.2158  0.04443  0.0
 0.9746  0.793    0.6294</code></pre><h2 id="Indexing-LowerTriangularMatrix"><a class="docs-heading-anchor" href="#Indexing-LowerTriangularMatrix">Indexing <code>LowerTriangularMatrix</code></a><a id="Indexing-LowerTriangularMatrix-1"></a><a class="docs-heading-anchor-permalink" href="#Indexing-LowerTriangularMatrix" title="Permalink"></a></h2><p><code>LowerTriangularMatrix</code> supports two types of indexing: 1) by denoting two indices, column and row <code>[l,m]</code> or 2) by denoting a single index <code>[lm]</code>. The double index works as expected</p><pre><code class="language-julia hljs">julia&gt; L
3×3 LowerTriangularMatrix{Float16}:
 0.1499  0.0    0.0
 0.1177  0.478  0.0
 0.1709  0.756  0.3223

julia&gt; L[2,2]
Float16(0.478)</code></pre><p>But the single index skips the zero entries in the upper triangle, i.e.</p><pre><code class="language-julia hljs">julia&gt; L[4]
Float16(0.478)</code></pre><p>which, important, is different from single indices of an <code>AbstractMatrix</code></p><pre><code class="language-julia hljs">julia&gt; Matrix(L)[4]
Float16(0.0)</code></pre><p>In performance-critical code a single index should be used, as this directly maps to the index of the underlying data vector. The double index is somewhat slower as it first has to be converted to the corresponding single index.</p><p>Consequently, many loops in SpeedyWeather.jl are build with the following structure</p><pre><code class="language-julia hljs">n,m = size(L)
ij = 0
for j in 1:m
    for i in j:n
        ij += 1
        L[ij] = i+j
    end
end</code></pre><p>which loops over all lower triangle entries of <code>L::LowerTriangularMatrix</code> and the single index <code>ij</code> is simply counted up. However, one could also use <code>[i,j]</code> as indices in the loop body or to perform any calculation (<code>i+j</code> here). An iterator over all entries in the lower triangle can be created by</p><pre><code class="language-julia hljs">for ij in eachindex(L)
    # do something
end</code></pre><p>The <code>setindex!</code> functionality of matrixes will throw a <code>BoundsError</code> when trying to write into the upper triangle of a <code>LowerTriangularMatrix</code>, for example</p><pre><code class="language-julia hljs">julia&gt; L[2,1] = 0    # valid index
0

julia&gt; L[1,2] = 0    # invalid index in the upper triangle
ERROR: BoundsError: attempt to access 3×3 LowerTriangularMatrix{Float32} at index [1, 2]</code></pre><h2 id="Linear-algebra-with-LowerTriangularMatrix"><a class="docs-heading-anchor" href="#Linear-algebra-with-LowerTriangularMatrix">Linear algebra with <code>LowerTriangularMatrix</code></a><a id="Linear-algebra-with-LowerTriangularMatrix-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-algebra-with-LowerTriangularMatrix" title="Permalink"></a></h2><p>The <a href="#LowerTriangularMatrices">LowerTriangularMatrices</a> module&#39;s main purpose is not linear algebra, and it&#39;s implementation may not be efficient, however, many operations work as expected</p><pre><code class="language-julia hljs">julia&gt; L = rand(LowerTriangularMatrix{Float32},3,3)
3×3 LowerTriangularMatrix{Float32}:
 0.57649   0.0       0.0
 0.348685  0.875371  0.0
 0.881923  0.850552  0.998306

julia&gt; L + L
3×3 LowerTriangularMatrix{Float32}:
 1.15298   0.0      0.0
 0.697371  1.75074  0.0
 1.76385   1.7011   1.99661

julia&gt; L * L
3×3 Matrix{Float32}:
 0.332341  0.0       0.0
 0.506243  0.766275  0.0
 1.68542   1.59366   0.996616</code></pre><p>Note, however, that the latter includes a conversion to <code>Matrix</code>, which is true for many operations, including <code>inv</code> or <code>\</code>. Hence when trying to do more sophisticated linear algebra with <code>LowerTriangularMatrix</code> we quickly leave lower triangular-land and go back to normal matrix-land.</p><h2 id="Function-index"><a class="docs-heading-anchor" href="#Function-index">Function index</a><a id="Function-index-1"></a><a class="docs-heading-anchor-permalink" href="#Function-index" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="SpeedyWeather.LowerTriangularMatrices.LowerTriangularMatrix" href="#SpeedyWeather.LowerTriangularMatrices.LowerTriangularMatrix"><code>SpeedyWeather.LowerTriangularMatrices.LowerTriangularMatrix</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia hljs">L = LowerTriangularMatrix{T}(v::Vector{T},m::Int,n::Int)</code></pre><p>A lower triangular matrix implementation that only stores the non-zero entries explicitly. <code>L&lt;:AbstractMatrix</code> although in general we have <code>L[i] != Matrix(L)[i]</code>, the former skips zero entries, tha latter includes them.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/23c1b03509ac335153c07c6560b7691f9fd7f4cc/src/LowerTriangularMatrices/lower_triangular_matrix.jl#L1-L6">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SpeedyWeather.LowerTriangularMatrices.ij2k" href="#SpeedyWeather.LowerTriangularMatrices.ij2k"><code>SpeedyWeather.LowerTriangularMatrices.ij2k</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">k = ij2k(   i::Integer,     # row index of matrix
            j::Integer,     # column index of matrix
            m::Integer)     # number of rows in matrix</code></pre><p>Converts the index pair <code>i,j</code> of an <code>m</code>x<code>n</code> LowerTriangularMatrix <code>L</code> to a single index <code>k</code> that indexes the same element in the corresponding vector that stores only the lower triangle (the non-zero entries) of <code>L</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/23c1b03509ac335153c07c6560b7691f9fd7f4cc/src/LowerTriangularMatrices/lower_triangular_matrix.jl#L50-L57">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="Base.fill!-Union{Tuple{T}, Tuple{LowerTriangularMatrix{T}, Any}} where T" href="#Base.fill!-Union{Tuple{T}, Tuple{LowerTriangularMatrix{T}, Any}} where T"><code>Base.fill!</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia hljs">fill!(L::LowerTriangularMatrix,x)</code></pre><p>Fills the elements of <code>L</code> with <code>x</code>. Faster than fill!(::AbstractArray,x) as only the non-zero elements in <code>L</code> are assigned with x.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/23c1b03509ac335153c07c6560b7691f9fd7f4cc/src/LowerTriangularMatrices/lower_triangular_matrix.jl#L269-L273">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="SpeedyWeather.LowerTriangularMatrices.eachharmonic" href="#SpeedyWeather.LowerTriangularMatrices.eachharmonic"><code>SpeedyWeather.LowerTriangularMatrices.eachharmonic</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">unit_range = eachharmonic(L::LowerTriangular)</code></pre><p>creates <code>unit_range::UnitRange</code> to loop over all non-zeros in a LowerTriangularMatrix <code>L</code>. Like <code>eachindex</code> but skips the upper triangle with zeros in <code>L</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/23c1b03509ac335153c07c6560b7691f9fd7f4cc/src/LowerTriangularMatrices/lower_triangular_matrix.jl#L92-L96">source</a></section><section><div><pre><code class="nohighlight hljs">unit_range = eachharmonic(Ls::LowerTriangularMatrix...)</code></pre><p>creates <code>unit_range::UnitRange</code> to loop over all non-zeros in the LowerTriangularMatrices provided as arguments. Checks bounds first. All LowerTriangularMatrix&#39;s need to be of the same size. Like <code>eachindex</code> but skips the upper triangle with zeros in <code>L</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/23c1b03509ac335153c07c6560b7691f9fd7f4cc/src/LowerTriangularMatrices/lower_triangular_matrix.jl#L99-L104">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../ringgrids/">« Submodule: RingGrids</a><a class="docs-footer-nextpage" href="../speedytransforms/">Submodule: SpeedyTransforms »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 16 June 2023 15:09">Friday 16 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
