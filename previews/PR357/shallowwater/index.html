<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Shallow water model · SpeedyWeather.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather.jl</a></li><li><a class="tocitem" href="../spectral_transform/">Spherical harmonic transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li class="is-active"><a class="tocitem" href>Shallow water model</a><ul class="internal"><li><a class="tocitem" href="#Shallow-water-equations"><span>Shallow water equations</span></a></li><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li><li><a class="tocitem" href="#implicit_swm"><span>Semi-implicit time integration</span></a></li><li><a class="tocitem" href="#scaled_swm"><span>Scaled shallow water equations</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../extending/">Extending SpeedyWeather</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li><li><a class="tocitem" href="../ringgrids/">Submodule: RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">Submodule: LowerTriangularMatrices</a></li><li><a class="tocitem" href="../speedytransforms/">Submodule: SpeedyTransforms</a></li><li><a class="tocitem" href="../conventions/">Style and convention guide</a></li><li><a class="tocitem" href="../development/">Development notes</a></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Shallow water model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Shallow water model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/shallowwater.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Shallow-water-model"><a class="docs-heading-anchor" href="#Shallow-water-model">Shallow water model</a><a id="Shallow-water-model-1"></a><a class="docs-heading-anchor-permalink" href="#Shallow-water-model" title="Permalink"></a></h1><p>The shallow water model describes the evolution of a 2D flow described by its velocity and an interface height that conceptually represents pressure. A divergent flow affects the interface height which in turn can impose a pressure gradient force onto the flow. The dynamics include advection, forces, dissipation, and continuity.</p><p>The following description of the shallow water model largely follows the idealized models with spectral dynamics developed at the Geophysical Fluid Dynamics Laboratory<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>: The Shallow Water Equations<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>.</p><h2 id="Shallow-water-equations"><a class="docs-heading-anchor" href="#Shallow-water-equations">Shallow water equations</a><a id="Shallow-water-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Shallow-water-equations" title="Permalink"></a></h2><p>The shallow water equations of velocity <span>$\mathbf{u} = (u,v)$</span> and interface height <span>$\eta$</span> (i.e. the deviation from the fluid&#39;s rest height <span>$H$</span>) are, formulated in terms of relative vorticity <span>$\zeta = \nabla \times \mathbf{u}$</span>, divergence <span>$\mathcal{D} = \nabla \cdot \mathbf{u}$</span></p><p class="math-container">\[\begin{aligned}
\frac{\partial \zeta}{\partial t} + \nabla \cdot (\mathbf{u}(\zeta + f)) &amp;=
\nabla \times \mathbf{F} + (-1)^{n+1}\nu\nabla^{2n}\zeta, \\
\frac{\partial \mathcal{D}}{\partial t} - \nabla \times (\mathbf{u}(\zeta + f)) &amp;=
\nabla \cdot \mathbf{F} -\nabla^2(\tfrac{1}{2}(u^2 + v^2) + g\eta) + (-1)^{n+1}\nu\nabla^{2n}\mathcal{D}, \\
\frac{\partial \eta}{\partial t} + \nabla \cdot (\mathbf{u}h) &amp;= F_\eta,
\end{aligned}\]</p><p>We denote time<span>$t$</span>, Coriolis parameter <span>$f$</span>, a forcing vector <span>$\mathbf{F} = (F_u,F_v)$</span>, hyperdiffusion <span>$(-1)^{n+1} \nu \nabla^{2n}$</span> (<span>$n$</span> is the hyperdiffusion order,  see <a href="../barotropic/#diffusion">Horizontal diffusion</a>), gravitational acceleration <span>$g$</span>, dynamic layer thickness <span>$h$</span>, and a forcing for the interface height <span>$F_\eta$</span>. In the shallow water model the dynamics layer thickness <span>$h$</span> is</p><p class="math-container">\[h = \eta + H - H_b\]</p><p>that is, the layer thickness at rest <span>$H$</span> plus the interface height <span>$\eta$</span> minus orography <span>$H_b$</span>.</p><p>In the shallow water system the flow can be described through <span>$u,v$</span> or <span>$\zeta,\mathcal{D}$</span> which are related through the stream function <span>$\Psi$</span> and the velocity potential <span>$\Phi$</span> (which is zero in the <a href="../barotropic/#Barotropic-vorticity-equation">Barotropic vorticity equation</a>).</p><p class="math-container">\[\begin{aligned}
\zeta &amp;= \nabla^2 \Psi \\
\mathcal{D} &amp;= \nabla^2 \Phi \\
\mathbf{u} &amp;= \nabla^\perp \Psi + \nabla \Phi
\end{aligned}\]</p><p>With <span>$\nabla^\perp$</span> being the rotated gradient operator, in cartesian coordinates <span>$x,y$</span>: <span>$\nabla^\perp = (-\partial_y, \partial_x)$</span>. See <a href="../spectral_transform/#Derivatives-in-spherical-coordinates">Derivatives in spherical coordinates</a> for further details. Especially because the inversion of the <a href="../spectral_transform/#Laplacian">Laplacian</a> and the gradients of <span>$\Psi, \Phi$</span> can be computed in a single pass, see <a href="../spectral_transform/#U,V-from-vorticity-and-divergence">U,V from vorticity and divergence</a>.</p><p>The divergence/curl of the vorticity flux <span>$\mathbf{u}(\zeta + f)$</span> are combined with the divergence/curl of the forcing vector <span>$\mathbf{F}$</span>, as</p><p class="math-container">\[\begin{aligned}
- \nabla \cdot (\mathbf{u}(\zeta + f)) + \nabla \times \mathbf{F} &amp;=
\nabla \times (\mathbf{F} + \mathbf{u}_\perp(\zeta + f)) \\
\nabla \times (\mathbf{u}(\zeta + f)) + \nabla \cdot \mathbf{F} &amp;=
\nabla \cdot (\mathbf{F} + \mathbf{u}_\perp(\zeta + f))
\end{aligned}\]</p><p>equivalently to how this is done in the <a href="../barotropic/#Barotropic-vorticity-equation">Barotropic vorticity equation</a> with <span>$\mathbf{u}_\perp = (v,-u)$</span>.</p><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><p>0. Start with initial conditions of relative vorticity <span>$\zeta_{lm}$</span>, divergence <span>$D_{lm}$</span>, and interface height <span>$\eta_{lm}$</span> in spectral space and transform this model state to grid-point space:</p><ul><li>Invert the <a href="../spectral_transform/#Laplacian">Laplacian</a> of <span>$\zeta_{lm}$</span> to obtain the stream function <span>$\Psi_{lm}$</span> in spectral space</li><li>Invert the <a href="../spectral_transform/#Laplacian">Laplacian</a> of <span>$D_{lm}$</span> to obtain the velocity potential <span>$\Phi_{lm}$</span> in spectral space</li><li>obtain velocities <span>$U_{lm} = (\cos(\theta)u)_{lm}, V_{lm} = (\cos(\theta)v)_{lm}$</span> from <span>$\nabla^\perp\Psi_{lm} + \nabla\Phi_{lm}$</span></li><li>Transform velocities <span>$U_{lm}$</span>, <span>$V_{lm}$</span> to grid-point space <span>$U,V$</span></li><li>Unscale the <span>$\cos(\theta)$</span> factor to obtain <span>$u,v$</span></li><li>Transform <span>$\zeta_{lm}$</span>, <span>$D_{lm}$</span>, <span>$\eta_{lm}$</span> to <span>$\zeta, D, \eta$</span> in grid-point space</li></ul><p>Now loop over</p><ol><li>Compute the forcing vector <span>$\mathbf{F} = (F_u,F_v)$</span> for <span>$u$</span> and <span>$v$</span></li><li>Multiply <span>$u,v$</span> with <span>$\zeta+f$</span> in grid-point space</li><li>Add <span>$A = F_u + v(\zeta + f)$</span> and <span>$B = F_v - u(\zeta + f)$</span></li><li>Transform these vector components to spectral space <span>$A_{lm}$</span>, <span>$B_{lm}$</span></li><li>Compute the curl of <span>$(A,B)_{lm}$</span> in spectral space which is the tendency of <span>$\zeta_{lm}$</span></li><li>Compute the divergence of <span>$(A,B)_{lm}$</span> in spectral space which is the tendency of <span>$\mathcal{D}_{lm}$</span></li><li>Compute the kinetic energy <span>$\frac{1}{2}(u^2 + v^2)$</span> and transform to spectral space</li><li>Add to the kinetic energy the &quot;geopotential&quot; <span>$g\eta_{lm}$</span> in spectral space to obtain the Bernoulli potential</li><li>Take the Laplacian of the Bernoulli potential and subtract from the divergence tendency</li><li>Compute the volume fluxes <span>$uh,vh$</span> in grid-point space via <span>$h = \eta + H - H_b$</span></li><li>Transform to spectral space and take the divergence for <span>$-\nabla \cdot (\mathbf{u}h)$</span> which is the tendency for <span>$\eta$</span></li><li>Add possibly forcing <span>$F_\eta$</span> for <span>$\eta$</span> in spectral space</li><li>Correct the tendencies following the <a href="#implicit_swm">semi-implicit time integration</a> to prevent fast gravity waves from causing numerical instabilities</li><li>Compute the <a href="../barotropic/#diffusion">horizontal diffusion</a> based on the <span>$\zeta,\mathcal{D}$</span> tendencies</li><li>Compute a leapfrog time step as described in <a href="../barotropic/#leapfrog">Time integration</a> with a <a href="../barotropic/#Robert-Asselin-and-Williams-filter">Robert-Asselin and Williams filter</a></li><li>Transform the new spectral state of <span>$\zeta_{lm}$</span>, <span>$\mathcal{D}_{lm}$</span>, <span>$\eta_{lm}$</span> to grid-point <span>$u,v,\zeta,\mathcal{D},\eta$</span> as described in 0.</li><li>Possibly do some output</li><li>Repeat from 1.</li></ol><h2 id="implicit_swm"><a class="docs-heading-anchor" href="#implicit_swm">Semi-implicit time integration</a><a id="implicit_swm-1"></a><a class="docs-heading-anchor-permalink" href="#implicit_swm" title="Permalink"></a></h2><p>Probably the biggest advantage of a spectral model is its ability to solve (parts of) the equations implicitly a low computational cost. The reason is that a linear operator can be easily inverted in spectral space, removing the necessity to solve large equation systems. An operation like <span>$\Psi = \nabla^{-2}\zeta$</span> in grid-point space is costly because it requires a global communication, coupling all grid points. In spectral space <span>$\nabla^2$</span> is a diagonal operator, meaning that there is no communication between harmonics and its inversion is therefore easily done on a mode-by-mode basis of the harmonics.</p><p>This can be made use of when facing time stepping constraints with explicit schemes, where ridiculuously small time steps to resolve fast waves would otherwise result in a horribly slow simulation.  In the shallow water system there are gravity waves that propagate at a wave speed of <span>$\sqrt{gH}$</span> (typically 300m/s), which, in order to not violate the <a href="https://en.wikipedia.org/wiki/Courant%E2%80%93Friedrichs%E2%80%93Lewy_condition">CFL criterion</a> for explicit time stepping, would need to be resolved. Therefore, treating the terms that are responsible for gravity waves implicitly would remove that time stepping constraint and allows us to run the simulation at the time step needed to resolve the advective motion of the atmosphere, which is usually one or two orders of magnitude longer than gravity waves.</p><p>In the following we will describe how the semi implicit time integration can be combined with the <a href="../barotropic/#leapfrog">Leapfrog time stepping</a> and the <a href="../barotropic/#Robert-Asselin-and-Williams-filter">Robert-Asselin and Williams filter</a> for a large increase in numerical stability with gravity waves. Let <span>$V_i$</span> be the model state of all prognostic variables at time step <span>$i$</span>, the <a href="../barotropic/#leapfrog">leapfrog time stepping</a> is then</p><p class="math-container">\[\frac{V_{i+1} - V_{i-1}}{2\Delta t} = N(V_{i})\]</p><p>with the right-hand side operator <span>$N$</span> evaluated at the current time step <span>$i$</span>. Now the idea is to split the terms in <span>$N$</span> into non-linear terms that are evaluated explicitly in <span>$N_E$</span> and into the linear terms <span>$N_I$</span>, solved implicitly, that are responsible for the gravity waves. We could already assume to evaluate <span>$N_I$</span> at <span>$i+1$</span>, but in fact, we can introduce <span>$\alpha \in [0,1]$</span> so that for <span>$\alpha=0$</span> we use <span>$i-1$</span> (i.e. explicit), for <span>$\alpha=1/2$</span> it is centred implicit <span>$\tfrac{1}{2}N_I(V_{i-1}) + \tfrac{1}{2}N_I(V_{i+1})$</span>, and for <span>$\alpha=1$</span> a fully backwards scheme <span>$N_I(V_{i+1})$</span> evaluated at <span>$i+1$</span>.</p><p class="math-container">\[\frac{V_{i+1} - V_{i-1}}{2\Delta t} = N_E(V_{i}) + \alpha N_I(V_{i+1}) + (1-\alpha)N_I(V_{i-1})\]</p><p>Let <span>$\delta V = \tfrac{V_{i+1} - V_{i-1}}{2\Delta t}$</span> be the tendency we need for the Leapfrog time stepping. Introducing <span>$\xi = 2\alpha\Delta t$</span> we have</p><p class="math-container">\[\delta V = N_E(V_i) + N_I(V_{i-1}) + \xi N_I(\delta V)\]</p><p>because <span>$N_I$</span> is a linear operator. This is done so that we can solve for <span>$\delta V$</span> by inverting <span>$N_I$</span>, but let us gather the other terms as <span>$G$</span> first.</p><p class="math-container">\[G = N_E(V_i) + N_I(V_{i-1}) = N(V_i) + N_I(V_{i-1} - V_i)\]</p><p>For the shallow water equations we will only make use of the last formulation, meaning  we first evaluate the whole right-hand side <span>$N(V_i)$</span> at the current time step as we would do with fully explicit time stepping but then add the implicit terms <span>$N_I(V_{i-1} - V_i)$</span> afterwards to move those terms from <span>$i$</span> to <span>$i-1$</span>. Note that we could also directly evaluate the implicit terms at <span>$i-1$</span> as it is suggested in the previous formulation <span>$N_E(V_i) + N_I(V_{i-1})$</span>, the result would be the same. But in general it can be more efficient to do it one or the other way, and in fact it is also possible to combine both ways. This will be discussed in the <a href="../primitiveequation/#implicit_primitive">semi-implicit time stepping for the primitive equations</a>.</p><p>We can now implicitly solve for <span>$\delta V$</span> by</p><p class="math-container">\[\delta V = (1-\xi N_I)^{-1}G\]</p><p>So what is <span>$N_I$</span>? In the shallow water system the gravity waves are caused by</p><p class="math-container">\[\begin{aligned}
\frac{\partial \mathcal{D}}{\partial t} &amp;= -g\nabla^2\eta \\
\frac{\partial \eta}{\partial t} &amp;= -H\mathcal{D},
\end{aligned}\]</p><p>which is a linearization of the equations around a state of rest with uniform constant layer thickness <span>$h = H$</span>. The continuity equation with the <span>$-\nabla(\mathbf{u}h)$</span> term, for example, is linearized to <span>$-\nabla(\mathbf{u}H) = -H\mathcal{D}$</span>. The divergence and continuity equations can now be written following the <span>$\delta V = G + \xi N_I(\delta V)$</span> formulation from above as a coupled system (The vorticity equation is zero for the linear gravity wave equation in the shallow water equations, hence no semi-implicit correction has to be made to the vorticity tendency).</p><p class="math-container">\[\begin{aligned}
\delta \mathcal{D} &amp;= G_\mathcal{D} - \xi g \nabla^2 \delta \eta \\
\delta \eta &amp;= G_\mathcal{\eta} - \xi H \delta\mathcal{D}
\end{aligned}\]</p><p>with</p><p class="math-container">\[\begin{aligned}
G_\mathcal{D} &amp;= N_\mathcal{D} - \xi g \nabla^2 (\eta_{i-1} - \eta_i) \\
G_\mathcal{\eta} &amp;= N_\eta - \xi H (\mathcal{D}_{i-1} - \mathcal{D}_i)
\end{aligned}\]</p><p>Inserting the second equation into the first, we can first solve for <span>$\delta \mathcal{D}$</span>, and then for <span>$\delta \eta$</span>. Reminder that we do this in spectral space to every harmonic independently, so the Laplace operator <span>$\nabla^2 = -l(l+1)$</span> takes the form of its eigenvalue <span>$-l(l+1)$</span> (normalized to unit sphere, as are the <a href="#scaled_swm">scaled shallow water equations</a>) and its inversion is therefore just the inversion of this scalar.</p><p class="math-container">\[\delta D = \frac{G_\mathcal{D} - \xi g\nabla^2 G_\eta}{1 - \xi^2 H \nabla^2} =: S^{-1}(G_\mathcal{D} - \xi g\nabla^2 G_\eta) \]</p><p>Where the last formulation just makes it clear that <span>$S = 1 - \xi^2 H \nabla^2$</span> is the operator to be inverted. <span>$\delta \eta$</span> is then obtained via insertion as written above. Equivalently, by adding a superscript <span>$l$</span> for every degree of the spherical harmonics, we have</p><p class="math-container">\[\delta \mathcal{D}^l = \frac{G_\mathcal{D}^l + \xi g l(l+1) G_\eta^l}{1 + \xi^2 H l(l+1)}\]</p><p>The idea of the semi-implicit time stepping is now as follows:</p><ol><li>Evaluate the right-hand side explicitly at time step <span>$i$</span> to obtain the explicit, preliminary tendencies <span>$N_\mathcal{D},N_\eta$</span> (and <span>$N_\zeta$</span> without a need for semi-implicit correction)</li><li>Move the implicit terms from <span>$i$</span> to <span>$i-1$</span> when calculating <span>$G_\mathcal{D}, G_\eta$</span></li><li>Solve for <span>$\delta \mathcal{D}$</span>, the new, corrected tendency for divergence.</li><li>With <span>$\delta \mathcal{D}$</span> obtain <span>$\delta \eta$</span>, the new, corrected tendency for <span>$\eta$</span>.</li><li>Apply horizontal diffusion as a correction to <span>$N_\zeta, \delta \mathcal{D}$</span> as outlined in <a href="../barotropic/#diffusion">Horizontal diffusion</a>.</li><li>Leapfrog with tendencies that have been corrected for both semi-implicit and diffusion.</li></ol><p>Some notes on the semi-implicit time stepping</p><ul><li>The inversion of the semi-implicit time stepping depends on <span>$\delta t$</span>, that means every time the time step changes, the inversion has to be recalculated.</li><li>You may choose <span>$\alpha = 1/2$</span> to dampen gravity waves but initialisation shocks still usually kick off many gravity waves that propagate around the sphere for many days.</li><li>With increasing <span>$\alpha &gt; 1/2$</span> these waves are also slowed down, such that for <span>$\alpha = 1$</span> they quickly disappear in several hours.</li><li>Using the <a href="#scaled_swm">scaled shallow water equations</a> the time step <span>$\delta t$</span> has to be the scaled time step <span>$\tilde{\Delta t} = \delta t/R$</span> which is divided by the radius <span>$R$</span>. Then we use the normalized eigenvalues <span>$-l(l+1)$</span> which also omit the <span>$1/R^2$</span> scaling, see <a href="#scaled_swm">scaled shallow water equations</a> for more details.</li></ul><h2 id="scaled_swm"><a class="docs-heading-anchor" href="#scaled_swm">Scaled shallow water equations</a><a id="scaled_swm-1"></a><a class="docs-heading-anchor-permalink" href="#scaled_swm" title="Permalink"></a></h2><p>Similar to the <a href="../barotropic/#scaling">scaled barotropic vorticity equations</a>, SpeedyWeather.jl scales in the shallow water equations. The vorticity and the divergence equation are scaled with <span>$R^2$</span>, the radius of the sphere squared, but the continuity equation is scaled with <span>$R$</span>. We also combine the vorticity flux and forcing into a single divergence/curl operation as mentioned in <a href="#Shallow-water-equations">Shallow water equations</a> above</p><p class="math-container">\[\begin{aligned}
\frac{\partial \tilde{\zeta}}{\partial \tilde{t}} &amp;=
\tilde{\nabla} \times (\tilde{\mathbf{F}} + \mathbf{u}_\perp(\tilde{\zeta} + \tilde{f})) +
(-1)^{n+1}\tilde{\nu}\tilde{\nabla}^{2n}\tilde{\zeta} \\
\frac{\partial \tilde{\mathcal{D}}}{\partial \tilde{t}} &amp;=
\tilde{\nabla} \cdot (\tilde{\mathbf{F}} + \mathbf{u}_\perp(\tilde{\zeta} + \tilde{f})) -
\tilde{\nabla}^2\left(\tfrac{1}{2}(u^2 + v^2) + g\eta \right) +
(-1)^{n+1}\tilde{\nu}\tilde{\nabla}^{2n}\tilde{\mathcal{D}} \\
\frac{\partial \eta}{\partial \tilde{t}} &amp;=
- \tilde{\nabla} \cdot (\mathbf{u}h) + \tilde{F}_\eta.
\end{aligned}\]</p><p>As in the <a href="../barotropic/#scaling">scaled barotropic vorticity equations</a>, one needs to scale the time step, the Coriolis force, the forcing and the diffusion coefficient, but then enjoys the luxury of working with dimensionless gradient operators. As before, SpeedyWeather.jl will scale vorticity and divergence just before the model integration starts and unscale them upon completion and for output. In the  <a href="#implicit_swm">semi-implicit time integration</a> we solve an equation that also has to be scaled. It is with radius squared scaling (because it is the tendency for the divergence equation which is also scaled with <span>$R^2$</span>)</p><p class="math-container">\[R^2 \delta D = R^2\frac{G_\mathcal{D} - \xi g\nabla^2 G_\eta}{1 - \xi^2 H \nabla^2}\]</p><p>As <span>$G_\eta$</span> is only scaled with <span>$R$</span> we have</p><p class="math-container">\[\tilde{\delta D} = \frac{\tilde{G_\mathcal{D}} - \tilde{\xi} g\tilde{\nabla}^2 \tilde{G_\eta}}{1 - \tilde{\xi}^2 H \tilde{\nabla}^2}\]</p><p>The <span>$R^2$</span> normalizes the Laplace operator in the numerator, but using the scaled <span>$G_\eta$</span> we also scale <span>$\xi$</span> (which is convenient, because the time step within is the one we use anyway). The denominator <span>$S$</span> does not actually change because <span>$\xi^2\nabla^2 = \tilde{\xi}^2\tilde{\nabla}^2$</span> as <span>$\xi^2$</span> is scaled with <span>$1/R^2$</span>, but the Laplace operator with <span>$R^2$</span>. So overall we just have to use the scaled time step <span>$\tilde{\Delta t}$</span> and normalized eigenvalues for <span>$\tilde{\nabla}^2$</span>.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Geophysical Fluid Dynamics Laboratory, <a href="https://www.gfdl.noaa.gov/idealized-models-with-spectral-dynamics/">Idealized models with spectral dynamics</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Geophysical Fluid Dynamics Laboratory, <a href="https://www.gfdl.noaa.gov/wp-content/uploads/files/user_files/pjp/shallow.pdf">The Shallow Water Equations</a>.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../barotropic/">« Barotropic model</a><a class="docs-footer-nextpage" href="../primitiveequation/">Primitive equation model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 16 June 2023 15:39">Friday 16 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
