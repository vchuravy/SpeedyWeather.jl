<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Barotropic model · SpeedyWeather.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather.jl</a></li><li><a class="tocitem" href="../spectral_transform/">Spherical harmonic transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li><li class="is-active"><a class="tocitem" href>Barotropic model</a><ul class="internal"><li><a class="tocitem" href="#Barotropic-vorticity-equation"><span>Barotropic vorticity equation</span></a></li><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li><li><a class="tocitem" href="#diffusion"><span>Horizontal diffusion</span></a></li><li><a class="tocitem" href="#scaling"><span>Radius scaling</span></a></li><li><a class="tocitem" href="#leapfrog"><span>Time integration</span></a></li><li><a class="tocitem" href="#Robert-Asselin-and-Williams-filter"><span>Robert-Asselin and Williams filter</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li><a class="tocitem" href="../primitiveequation/">Primitive equation model</a></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../extending/">Extending SpeedyWeather</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li><li><a class="tocitem" href="../ringgrids/">Submodule: RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">Submodule: LowerTriangularMatrices</a></li><li><a class="tocitem" href="../speedytransforms/">Submodule: SpeedyTransforms</a></li><li><a class="tocitem" href="../conventions/">Style and convention guide</a></li><li><a class="tocitem" href="../development/">Development notes</a></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Barotropic model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Barotropic model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/barotropic.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Barotropic-vorticity-model"><a class="docs-heading-anchor" href="#Barotropic-vorticity-model">Barotropic vorticity model</a><a id="Barotropic-vorticity-model-1"></a><a class="docs-heading-anchor-permalink" href="#Barotropic-vorticity-model" title="Permalink"></a></h1><p>The barotropic vorticity model describes the evolution of a 2D non-divergent flow with velocity components <span>$\mathbf{u} = (u,v)$</span> through self-advection, forces and dissipation. Due to the non-divergent nature of the flow, it can be described by (the vertical component) of the relative vorticity <span>$\zeta = \nabla \times \mathbf{u}$</span>.</p><p>The dynamical core presented here to solve the barotropic vorticity equations largely follows the idealized models with spectral dynamics developed at the Geophysical Fluid Dynamics Laboratory<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup>: A barotropic vorticity model<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>.</p><p>Many concepts of the <a href="../shallowwater/#Shallow-water-model">Shallow water model</a> and the <a href="../primitiveequation/#Primitive-equation-model">Primitive equation model</a> are similar, such that for example <a href="#diffusion">horizontal diffusion</a> and the <a href="#leapfrog">Time integration</a> are only explained here.</p><h2 id="Barotropic-vorticity-equation"><a class="docs-heading-anchor" href="#Barotropic-vorticity-equation">Barotropic vorticity equation</a><a id="Barotropic-vorticity-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Barotropic-vorticity-equation" title="Permalink"></a></h2><p>The barotropic vorticity equation is the prognostic equation that describes the time evolution of relative vorticity <span>$\zeta$</span> with advection, Coriolis force, forcing and diffusion in a single global layer on the sphere.</p><p class="math-container">\[\frac{\partial \zeta}{\partial t} + \nabla \cdot (\mathbf{u}(\zeta + f)) =
\nabla \times \mathbf{F} + (-1)^{n+1}\nu\nabla^{2n}\zeta\]</p><p>We denote time<span>$t$</span>, velocity vector <span>$\mathbf{u} = (u, v)$</span>, Coriolis parameter <span>$f$</span>, and hyperdiffusion <span>$(-1)^{n+1} \nu \nabla^{2n} \zeta$</span> (<span>$n$</span> is the hyperdiffusion order,  see <a href="#diffusion">Horizontal diffusion</a>). We also include a forcing vector <span>$\mathbf{F} = (F_u,F_v)$</span> which acts on the zonal velocity <span>$u$</span> and the meridional velocity <span>$v$</span> and hence its curl <span>$\nabla \times \mathbf{F}$</span> is a tendency for relative vorticity <span>$\zeta$</span>.</p><p>Starting with some relative vorticity <span>$\zeta$</span>, the <a href="../spectral_transform/#Laplacian">Laplacian</a> is inverted to obtain the stream function <span>$\Psi$</span></p><p class="math-container">\[\Psi = \nabla^{-2}\zeta\]</p><p>The zonal velocity <span>$u$</span> and meridional velocity <span>$v$</span> are then the (negative) meridional gradient and zonal gradient of <span>$\Psi$</span></p><p class="math-container">\[\begin{aligned}
u &amp;= -\frac{1}{R} \frac{\partial \Psi}{\partial \theta} \\
v &amp;= \frac{1}{R\cos(\theta)} \frac{\partial \Psi}{\partial \phi} \\
\end{aligned}\]</p><p>which is described in <a href="../spectral_transform/#Derivatives-in-spherical-coordinates">Derivatives in spherical coordinates</a>. Using <span>$u$</span> and <span>$v$</span> we can then advect the absolute vorticity <span>$\zeta + f$</span>. In order to avoid to calculate both the curl and the divergence of a flux we rewrite the barotropic vorticity equation as</p><p class="math-container">\[\frac{\partial \zeta}{\partial t} =
\nabla \times (\mathbf{F} + \mathbf{u}_\perp(\zeta + f)) + (-1)^{n+1}\nu\nabla^{2n}\zeta\]</p><p>with <span>$\mathbf{u}_\perp = (v,-u)$</span> the rotated velocity vector, because <span>$-\nabla\cdot\mathbf{u} = \nabla \times \mathbf{u}_\perp$</span>. This is the form that is solved in the <code>BarotropicModel</code>, as outlined in the following section.</p><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><p>We briefly outline the algorithm that SpeedyWeather.jl uses in order to integrate the barotropic vorticity equation. As an initial step</p><p>0. Start with initial conditions of <span>$\zeta_{lm}$</span> in spectral space and transform this model state to grid-point space:</p><ul><li>Invert the <a href="../spectral_transform/#Laplacian">Laplacian</a> of vorticity <span>$\zeta_{lm}$</span> to obtain the stream function <span>$\Psi_{lm}$</span> in spectral space</li><li>obtain zonal velocity <span>$(\cos(\theta)u)_{lm}$</span> through a <a href="../spectral_transform/#Meridional-derivative">Meridional derivative</a></li><li>obtain meridional velocity <span>$(\cos(\theta)v)_{lm}$</span> through a <a href="../spectral_transform/#Zonal-derivative">Zonal derivative</a></li><li>Transform zonal and meridional velocity <span>$(\cos(\theta)u)_{lm}$</span>, <span>$(\cos(\theta)v)_{lm}$</span> to grid-point space</li><li>Unscale the <span>$\cos(\theta)$</span> factor to obtain <span>$u,v$</span></li><li>Transform <span>$\zeta_{lm}$</span> to <span>$\zeta$</span> in grid-point space</li></ul><p>Now loop over</p><ol><li>Compute the forcing vector <span>$\mathbf{F} = (F_u,F_v)$</span> for <span>$u$</span> and <span>$v$</span></li><li>Multiply <span>$u,v$</span> with <span>$\zeta+f$</span> in grid-point space</li><li>Add <span>$A = F_u + v(\zeta + f)$</span> and <span>$B = F_v - u(\zeta + f)$</span></li><li>Transform these vector components to spectral space <span>$A_{lm}$</span>, <span>$B_{lm}$</span></li><li>Compute the curl of <span>$(A,B)_{lm}$</span> in spectral space which is the tendency of <span>$\zeta_{lm}$</span></li><li>Compute the <a href="#diffusion">horizontal diffusion</a> based on that tendency</li><li>Compute a leapfrog time step as described in <a href="#leapfrog">Time integration</a> with a <a href="#Robert-Asselin-and-Williams-filter">Robert-Asselin and Williams filter</a></li><li>Transform the new spectral state of <span>$\zeta_{lm}$</span> to grid-point <span>$u,v,\zeta$</span> as described in 0.</li><li>Possibly do some output</li><li>Repeat from 1.</li></ol><h2 id="diffusion"><a class="docs-heading-anchor" href="#diffusion">Horizontal diffusion</a><a id="diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#diffusion" title="Permalink"></a></h2><p>In SpeedyWeather.jl we use hyerdiffusion through an <span>$n$</span>-th power Laplacian <span>$(-1)^{n+1}\nabla^{2n}$</span> (hyper when <span>$n&gt;1$</span>) which can be implemented as a multiplication of the spectral coefficients <span>$\Psi_{lm}$</span> with <span>$(-l(l+1))^nR^{-2n}$</span> (see spectral <a href="../spectral_transform/#Laplacian">Laplacian</a>) It is therefore computationally not more expensive to apply hyperdiffusion over diffusion as the <span>$(-l(l+1))^nR^{-2n}$</span> can be precomputed. Note the sign change <span>$(-1)^{n+1}$</span> here is such that the dissipative nature of the diffusion operator is retained for <span>$n$</span> odd and even.</p><p>In SpeedyWeather.jl the diffusion is applied <em>implicitly</em>. For that, consider a <a href="https://en.wikipedia.org/wiki/Leapfrog_integration">leapfrog scheme</a> with time step <span>$\Delta t$</span> of variable <span>$\zeta$</span> to obtain from time steps <span>$i-1$</span> and <span>$i$</span>, the next time step <span>$i+1$</span></p><p class="math-container">\[\zeta_{i+1} = \zeta_{i-1} + 2\Delta t d\zeta,\]</p><p>with <span>$d\zeta$</span> being some tendency evaluated from <span>$\zeta_i$</span>. Now we want to add a diffusion term <span>$(-1)^{n+1}\nu \nabla^{2n}\zeta$</span> with coefficient <span>$\nu$</span>, which however, is implicitly calculated from <span>$\zeta_{i+1}$</span>, then</p><p class="math-container">\[\zeta_{i+1} = \zeta_{i-1} + 2\Delta t (d\zeta + (-1)^{n+1} \nu\nabla^{2n}\zeta_{i+1})\]</p><p>As the application of <span>$(-1)^{n+1}\nu\nabla^{2n}$</span> is, for every spectral mode, equivalent to a multiplication of a constant, we can rewrite this to</p><p class="math-container">\[\zeta_{i+1} = \frac{\zeta_{i-1} + 2\Delta t d\zeta}{1 - 2\Delta (-1)^{n+1}\nu\nabla^{2n}},\]</p><p>and expand the numerator to</p><p class="math-container">\[\zeta_{i+1} = \zeta_{i-1} + 2\Delta t \frac{d\zeta + (-1)^{n+1} \nu\nabla^{2n}\zeta_{i-1}}{1 - 2\Delta t (-1)^{n+1}\nu \nabla^{2n}},\]</p><p>Hence the diffusion can be applied implicitly by updating the tendency <span>$d\zeta$</span> as</p><p class="math-container">\[d\zeta \to \frac{d\zeta + (-1)^{n+1}\nu\nabla^{2n}\zeta_{i-1}}{1 - 2\Delta t \nu \nabla^{2n}}\]</p><p>which only depends on <span>$\zeta_{i-1}$</span>. Now let <span>$D_\text{explicit} = (-1)^{n+1}\nu\nabla^{2n}$</span> be the explicit part and <span>$D_\text{implicit} = 1 - (-1)^{n+1} 2\Delta t \nu\nabla^{2n}$</span> the implicit part. Both parts can be precomputed and are <span>$D_\text{implicit} = 1 - 2\Delta t \nu\nabla^{2n}$</span> the implicit part. Both parts can be precomputed and are only an element-wise multiplication in spectral space. For every spectral harmonic <span>$l,m$</span> we do</p><p class="math-container">\[d\zeta \to D_\text{implicit}^{-1}(d\zeta + D_\text{explicit}\zeta_{i-1}).\]</p><p>Hence 2 multiplications and 1 subtraction with precomputed constants. However, we will normalize the (hyper-)Laplacians as described in the following. This also will take care of the alternating sign such that the diffusion operation is dissipative regardless the power <span>$n$</span>.</p><h3 id="Normalization-of-diffusion"><a class="docs-heading-anchor" href="#Normalization-of-diffusion">Normalization of diffusion</a><a id="Normalization-of-diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#Normalization-of-diffusion" title="Permalink"></a></h3><p>In physics, the Laplace operator <span>$\nabla^2$</span> is often used to represent diffusion due to viscosity in a fluid or diffusion that needs to be added to retain numerical stability. In both cases, the coefficient is <span>$\nu$</span> of units <span>$\text{m}^2\text{s}^{-1}$</span> and the full operator reads as <span>$\nu \nabla^2$</span> with units <span>$(\text{m}^2\text{s}^{-1})(\text{m}^{-2}) = \text{s}^{-1}$</span>. This motivates us to normalize the Laplace operator by a constant of units <span>$\text{m}^{-2}$</span> and the coefficient by its inverse such that it becomes a damping timescale of unit <span>$\text{s}^{-1}$</span>. Given the application in spectral space we decide to normalize by the largest eigenvalue <span>$-l_\text{max}(l_\text{max}+1)$</span> such that all entries in the discrete spectral Laplace operator are in <span>$[0,1]$</span>. This also has the effect that the alternating sign drops out, such that higher wavenumbers are always dampened and not amplified. The normalized coefficient <span>$\nu^* = l_\text{max}(l_\text{max}+1)\nu$</span> (always positive) is therefore reinterpreted as the (inverse) time scale at which the highest wavenumber is dampened to zero due to diffusion. Together we have </p><p class="math-container">\[D^\text{explicit}_{l,m} = -\nu^* \frac{l(l+1)}{l_\text{max}(l_\text{max}+1)}\]</p><p>and the hyper-Laplacian of power <span>$n$</span> follows as</p><p class="math-container">\[D^\text{explicit,n}_{l,m} = -\nu^* \left(\frac{l(l+1)}{l_\text{max}(l_\text{max}+1)}\right)^n\]</p><p>and the implicit part is accordingly <span>$D^\text{implicit,n}_{l,m} = 1 - 2\Delta t D^\text{explicit,n}_{l,m}$</span>. Note that the diffusion time scale <span>$\nu^*$</span> is then also scaled by the radius, see next section.</p><h2 id="scaling"><a class="docs-heading-anchor" href="#scaling">Radius scaling</a><a id="scaling-1"></a><a class="docs-heading-anchor-permalink" href="#scaling" title="Permalink"></a></h2><p>Similar to a non-dimensionalization of the equations, SpeedyWeather.jl scales the barotropic vorticity equation with <span>$R^2$</span> to obtain normalized gradient operators as follows. A scaling for vorticity <span>$\zeta$</span> and stream function <span>$\Psi$</span> is used that is</p><p class="math-container">\[\tilde{\zeta} = \zeta R, \tilde{\Psi} = \Psi R^{-1}.\]</p><p>This is also convenient as vorticity is often <span>$10^{-5}\text{ s}^{-1}$</span> in the atmosphere, but the streamfunction more like <span>$10^5\text{ m}^2\text{ s}^{-1}$</span> and so this scaling brings both closer to 1 with a typical radius of the Earth of 6371km. The inversion of the Laplacians in order to obtain <span>$\Psi$</span> from <span>$\zeta$</span> therefore becomes</p><p class="math-container">\[\tilde{\zeta} = \tilde{\nabla}^2 \tilde{\Psi}\]</p><p>where the dimensionless gradients simply omit the scaling with <span>$1/R$</span>, <span>$\tilde{\nabla} = R\nabla$</span>. The <a href="#Barotropic-vorticity-equation">Barotropic vorticity equation</a> scaled with <span>$R^2$</span> is</p><p class="math-container">\[\partial_{\tilde{t}}\tilde{\zeta} + \tilde{\nabla} \cdot (\mathbf{u}(\tilde{\zeta} + \tilde{f})) =
\nabla \times \tilde{\mathbf{F}} + (-1)^{n+1}\tilde{\nu}\tilde{\nabla}^{2n}\tilde{\zeta}\]</p><p>with</p><ul><li><span>$\tilde{t} = tR^{-1}$</span>, the scaled time <span>$t$</span></li><li><span>$\mathbf{u} = (u,v)$</span>, the velocity vector (no scaling applied)</li><li><span>$\tilde{f} = fR$</span>, the scaled Coriolis parameter <span>$f$</span></li><li><span>$\tilde{\mathbf{F}} = R\mathbf{F}$</span>, the scaled forcing vector <span>$\mathbf{F}$</span></li><li><span>$\tilde{\nu} = \nu^* R$</span>, the scaled diffusion coefficient <span>$\nu^*$</span>, which itself is normalized to a damping time scale, see <a href="#Normalization-of-diffusion">Normalization of diffusion</a>.</li></ul><p>So scaling with the radius squared means we can use dimensionless operators, however, this comes at the cost of needing to deal with both a time step in seconds as well as a scaled time step in seconds per meter, which can be confusing. Furthermore, some constants like Coriolis or the diffusion coefficient need to be scaled too during initialisation, which may be confusing too because values are not what users expect them to be. SpeedyWeather.jl follows the logic that the scaling to the prognostic variables is only applied just before the time integration and variables are unscaled for output and after the time integration finished. That way, the scaling is hidden as much as possible from the user. In hopefully many other cases it is clearly denoted that a variable or constant is <em>scaled</em>.</p><h2 id="leapfrog"><a class="docs-heading-anchor" href="#leapfrog">Time integration</a><a id="leapfrog-1"></a><a class="docs-heading-anchor-permalink" href="#leapfrog" title="Permalink"></a></h2><p>SpeedyWeather.jl is based on the <a href="https://en.wikipedia.org/wiki/Leapfrog_integration]">Leapfrog time integration</a>, which, for relative vorticity <span>$\zeta$</span>, is in its simplest form</p><p class="math-container">\[\frac{\zeta_{i+1} - \zeta_{i-1}}{2\Delta t} = RHS(\zeta_i),\]</p><p>meaning we step from the previous time step <span>$i-1$</span>, leapfrogging over the current time step<span>$i$</span> to the next time step <span>$i+1$</span> by evaluating the tendencies on the right-hand side <span>$RHS$</span> at the current time step <span>$i$</span>. The time stepping is done in spectral space. Once the right-hand side <span>$RHS$</span> is evaluated, leapfrogging is a linear operation, meaning that its simply applied to every spectral coefficient <span>$\zeta_{lm}$</span> as one would evaluate it on every grid point in grid-point models.</p><p>For the Leapfrog time integration two time steps of the prognostic variables have to be stored, <span>$i-1$</span> and <span>$i$</span>. Time step <span>$i$</span> is used to evaluate the tendencies which are then added to <span>$i-1$</span> in a step that also swaps the indices for the next time step <span>$i \to i-1$</span> and <span>$i+1 \to i$</span>, so that no additional memory than two time steps have to be stored at the same time.</p><p>The Leapfrog time integration has to be initialised with an Euler forward step in order to have a second time step <span>$i+1$</span> available when starting from <span>$i$</span> to actually leapfrog over. SpeedyWeather.jl therefore does two initial time steps that are different from the leapfrog time steps that follow and that have been described above.</p><ol><li>an Euler forward step with <span>$\Delta t/2$</span>, then</li><li>one leapfrog time step with <span>$\Delta t$</span>, then</li><li>leapfrog with <span>$2 \Delta t$</span> till the end</li></ol><p>This is particularly done in a way that after 2. we have <span>$t=0$</span> at <span>$i-1$</span> and <span>$t=\Delta t$</span> at <span>$i$</span> available so that 3. can start the leapfrogging without any offset from the intuitive spacing <span>$0,\Delta  t, 2\Delta t, 3\Delta t,...$</span>. The following schematic can be useful</p><table><tr><th style="text-align: right"></th><th style="text-align: right">time at step <span>$i-1$</span></th><th style="text-align: right">time at step <span>$i$</span></th><th style="text-align: right">time step at <span>$i+1$</span></th></tr><tr><td style="text-align: right">Initial conditions</td><td style="text-align: right"><span>$t = 0$</span></td><td style="text-align: right"></td><td style="text-align: right"></td></tr><tr><td style="text-align: right">1: Euler</td><td style="text-align: right">(T) <span>$\quad t = 0$</span></td><td style="text-align: right"><span>$t=\Delta t/2$</span></td><td style="text-align: right"></td></tr><tr><td style="text-align: right">2: Leapfrog with <span>$\Delta t$</span></td><td style="text-align: right"><span>$t = 0$</span></td><td style="text-align: right">(T) <span>$\quad t = \Delta t/2$</span></td><td style="text-align: right"><span>$t = \Delta t$</span></td></tr><tr><td style="text-align: right">3 to <span>$n$</span>: Leapfrog with <span>$2\Delta t$</span></td><td style="text-align: right"><span>$t-\Delta t$</span></td><td style="text-align: right">(T) <span>$\qquad \quad \quad t$</span></td><td style="text-align: right"><span>$t+\Delta t$</span></td></tr></table><p>The time step that is used to evaluate the tendencies is denoted with (T). It is always the time step furthest in time that is available.</p><h2 id="Robert-Asselin-and-Williams-filter"><a class="docs-heading-anchor" href="#Robert-Asselin-and-Williams-filter">Robert-Asselin and Williams filter</a><a id="Robert-Asselin-and-Williams-filter-1"></a><a class="docs-heading-anchor-permalink" href="#Robert-Asselin-and-Williams-filter" title="Permalink"></a></h2><p>The standard leapfrog time integration is often combined with a Robert-Asselin filter<sup class="footnote-reference"><a id="citeref-Robert66" href="#footnote-Robert66">[Robert66]</a></sup><sup class="footnote-reference"><a id="citeref-Asselin72" href="#footnote-Asselin72">[Asselin72]</a></sup> to dampen a computational mode. The idea is to start with a standard leapfrog step to obtain the next time step <span>$i+1$</span> but then to correct the current time step <span>$i$</span> by applying a filter which dampens the computational mode. The filter looks like a discrete Laplacian in time with a <span>$(1, -2, 1)$</span> stencil, and so, maybe unsurprisingly, is efficient to filter out a &quot;grid-scale oscillation&quot; in time, aka the computational mode. Let <span>$v$</span> be the unfiltered variable and <span>$u$</span> be the filtered variable, <span>$F$</span> the right-hand side tendency, then the standard leapfrog step is</p><p class="math-container">\[v_{i+1} = u_{i-1} + 2\Delta tF(v_i)\]</p><p>Meaning we start with a filtered variable <span>$u$</span> at the previous time step <span>$i-1$</span>, evaluate the tendency <span>$F(v_i)$</span> based on the current time step <span>$i$</span> to obtain an unfiltered next time step <span>$v_{i+1}$</span>. We then filter the current time step <span>$i$</span> (which will become <span>$i-1$</span> on the next iteration)</p><p class="math-container">\[u_i = v_i + \frac{\nu}{2}(v_{i+1} - 2v_i + u_{i-1})\]</p><p>by adding a discrete Laplacian with coefficient <span>$\tfrac{\nu}{2}$</span> to it, evaluated from the available filtered and unfiltered time steps centred around <span>$i$</span>: <span>$v_{i-1}$</span> is not available anymore because it was overwritten by the filtering at the previous iteration, <span>$u_i, u_{i+1}$</span> are not filtered yet when applying the Laplacian. The filter parameter <span>$\nu$</span> is typically chosen between 0.01-0.2, with stronger filtering for higher values.</p><p>Williams<sup class="footnote-reference"><a id="citeref-Williams2009" href="#footnote-Williams2009">[Williams2009]</a></sup> then proposed an additional filter step to regain accuracy that is otherwise lost with a strong Robert-Asselin filter<sup class="footnote-reference"><a id="citeref-Amezcua2011" href="#footnote-Amezcua2011">[Amezcua2011]</a></sup><sup class="footnote-reference"><a id="citeref-Williams2011" href="#footnote-Williams2011">[Williams2011]</a></sup>. Now let <span>$w$</span> be unfiltered, <span>$v$</span> be once filtered, and <span>$u$</span> twice filtered, then</p><p class="math-container">\[\begin{aligned}
w_{i+1} &amp;= u_{i-1} + 2\Delta tF(v_i) \\
u_i &amp;= v_i + \frac{\nu\alpha}{2}(w_{i+1} - 2v_i + u_{i-1}) \\
v_{i+1} &amp;= w_{i+1} - \frac{\nu(1-\alpha)}{2}(w_{i+1} - 2v_i + u_{i-1})
\end{aligned}\]</p><p>with the Williams filter parameter <span>$\alpha \in [0.5,1]$</span>. For <span>$\alpha=1$</span> we&#39;re back with the Robert-Asselin filter (the first two lines).</p><p>The Laplacian in the parentheses is often called a <em>displacement</em>, meaning that the filtered value is displaced (or corrected) in the direction of the two surrounding time steps. The Williams filter now also applies the same displacement, but in the opposite direction to the next time step <span>$i+1$</span> as a correction step (line 3 above) for a once-filtered value <span>$v_{i+1}$</span> which will then be twice-filtered by the Robert-Asselin filter on the next iteration. For more details see the referenced publications.</p><p>The initial Euler step (see <a href="#leapfrog">Time integration</a>, Table) is not filtered. Both the the Robert-Asselin and Williams filter are then switched on for all following leapfrog time steps.</p><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Geophysical Fluid Dynamics Laboratory, <a href="https://www.gfdl.noaa.gov/idealized-models-with-spectral-dynamics/">Idealized models with spectral dynamics</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Geophysical Fluid Dynamics Laboratory, <a href="https://www.gfdl.noaa.gov/wp-content/uploads/files/user_files/pjp/barotropic.pdf">The barotropic vorticity equation</a>.</li><li class="footnote" id="footnote-Robert66"><a class="tag is-link" href="#citeref-Robert66">Robert66</a>Robert, André. “The Integration of a Low Order Spectral Form of the Primitive Meteorological Equations.” Journal of the Meteorological Society of Japan 44 (1966): 237-245.</li><li class="footnote" id="footnote-Asselin72"><a class="tag is-link" href="#citeref-Asselin72">Asselin72</a>ASSELIN, R., 1972: Frequency Filter for Time Integrations. Mon. Wea. Rev., 100, 487–490, doi:<a href="https://doi.org/10.1175/1520-0493(1972)100&lt;0487:FFFTI&gt;2.3.CO;2.">10.1175/1520-0493(1972)100&lt;0487:FFFTI&gt;2.3.CO;2</a></li><li class="footnote" id="footnote-Williams2009"><a class="tag is-link" href="#citeref-Williams2009">Williams2009</a>Williams, P. D., 2009: A Proposed Modification to the Robert–Asselin Time Filter. Mon. Wea. Rev., 137, 2538–2546, <a href="https://doi.org/10.1175/2009MWR2724.1">10.1175/2009MWR2724.1</a>.</li><li class="footnote" id="footnote-Amezcua2011"><a class="tag is-link" href="#citeref-Amezcua2011">Amezcua2011</a>Amezcua, J., E. Kalnay, and P. D. Williams, 2011: The Effects of the RAW Filter on the Climatology and Forecast Skill of the SPEEDY Model. Mon. Wea. Rev., 139, 608–619, doi:<a href="https://doi.org/10.1175/2010MWR3530.1">10.1175/2010MWR3530.1</a>. </li><li class="footnote" id="footnote-Williams2011"><a class="tag is-link" href="#citeref-Williams2011">Williams2011</a>Williams, P. D., 2011: The RAW Filter: An Improvement to the Robert–Asselin Filter in Semi-Implicit Integrations. Mon. Wea. Rev., 139, 1996–2007, doi:<a href="https://doi.org/10.1175/2010MWR3601.1">10.1175/2010MWR3601.1</a>. </li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../grids/">« Grids</a><a class="docs-footer-nextpage" href="../shallowwater/">Shallow water model »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 16 June 2023 15:17">Friday 16 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
