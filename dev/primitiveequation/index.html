<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Primitive equation model · SpeedyWeather.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">SpeedyWeather.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../installation/">Installation</a></li><li><a class="tocitem" href="../how_to_run_speedy/">How to run SpeedyWeather.jl</a></li><li><a class="tocitem" href="../spectral_transform/">Spherical harmonic transform</a></li><li><a class="tocitem" href="../grids/">Grids</a></li><li><a class="tocitem" href="../barotropic/">Barotropic model</a></li><li><a class="tocitem" href="../shallowwater/">Shallow water model</a></li><li class="is-active"><a class="tocitem" href>Primitive equation model</a><ul class="internal"><li><a class="tocitem" href="#Virtual-temperature"><span>Virtual temperature</span></a></li><li><a class="tocitem" href="#Vertical-coordinates"><span>Vertical coordinates</span></a></li><li><a class="tocitem" href="#Geopotential"><span>Geopotential</span></a></li><li><a class="tocitem" href="#Surface-pressure-tendency"><span>Surface pressure tendency</span></a></li><li><a class="tocitem" href="#Vertical-advection"><span>Vertical advection</span></a></li><li><a class="tocitem" href="#Pressure-gradient-force"><span>Pressure gradient force</span></a></li><li><a class="tocitem" href="#Temperature-equation"><span>Temperature equation</span></a></li><li><a class="tocitem" href="#implicit_primitive"><span>Semi-implicit time stepping</span></a></li><li><a class="tocitem" href="#Horizontal-diffusion"><span>Horizontal diffusion</span></a></li><li><a class="tocitem" href="#Algorithm"><span>Algorithm</span></a></li><li><a class="tocitem" href="#Scaled-primitive-equations"><span>Scaled primitive equations</span></a></li><li><a class="tocitem" href="#References"><span>References</span></a></li></ul></li><li><a class="tocitem" href="../parameterizations/">Parameterizations</a></li><li><a class="tocitem" href="../extending/">Extending SpeedyWeather</a></li><li><a class="tocitem" href="../output/">NetCDF output</a></li><li><a class="tocitem" href="../ringgrids/">Submodule: RingGrids</a></li><li><a class="tocitem" href="../lowertriangularmatrices/">Submodule: LowerTriangularMatrices</a></li><li><a class="tocitem" href="../speedytransforms/">Submodule: SpeedyTransforms</a></li><li><a class="tocitem" href="../conventions/">Style and convention guide</a></li><li><a class="tocitem" href="../development/">Development notes</a></li><li><a class="tocitem" href="../functions/">Function and type index</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Primitive equation model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Primitive equation model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SpeedyWeather/SpeedyWeather.jl/blob/main/docs/src/primitiveequation.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Primitive-equation-model"><a class="docs-heading-anchor" href="#Primitive-equation-model">Primitive equation model</a><a id="Primitive-equation-model-1"></a><a class="docs-heading-anchor-permalink" href="#Primitive-equation-model" title="Permalink"></a></h1><p>The <a href="https://en.wikipedia.org/wiki/Primitive_equations">primitive equations</a> are a hydrostatic approximation of the compressible Navier-Stokes equations for an ideal gas on a rotating sphere. We largely follow the idealised spectral dynamical core developed by GFDL<sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup> and documented therein<sup class="footnote-reference"><a id="citeref-2" href="#footnote-2">[2]</a></sup>.</p><p>The primitive equations solved by SpeedyWeather.jl for relative vorticity <span>$\zeta$</span>, divergence <span>$\mathcal{D}$</span>, logarithm of surface pressure <span>$\ln p_s$</span>, temperature <span>$T$</span> and specific humidity <span>$q$</span> are</p><p class="math-container">\[\begin{aligned}
\frac{\partial \zeta}{\partial t} &amp;= \nabla \times (\mathbf{\mathcal{P}}_\mathbf{u}
+ (f+\zeta)\mathbf{u}_\perp - W(\mathbf{u}) - R_dT_v\nabla \ln p_s) \\
\frac{\partial \mathcal{D}}{\partial t} &amp;= \nabla \cdot (\mathcal{P}_\mathbf{u}
+ (f+\zeta)\mathbf{u}_\perp - W(\mathbf{u}) - R_dT_v\nabla \ln p_s) - \nabla^2(\frac{1}{2}(u^2 + v^2) + \Phi) \\
\frac{\partial \ln p_s}{\partial t} &amp;= -\frac{1}{p_s} \nabla \cdot \int_0^{p_s} \mathbf{u}~dp \\
\frac{\partial T}{\partial t} &amp;= \mathcal{P}_T -\nabla\cdot(\mathbf{u}T) + T\mathcal{D} - W(T) + \kappa T_v \frac{D \ln p}{Dt} \\
\frac{\partial q}{\partial t} &amp;= \mathcal{P}_q -\nabla\cdot(\mathbf{u}q) + q\mathcal{D} - W(q)\\
\end{aligned}\]</p><p>with velocity <span>$\mathbf{u} = (u,v)$</span>, rotated velocity <span>$\mathbf{u}_\perp = (v,-u)$</span>, Coriolis parameter <span>$f$</span>, <span>$W$</span> the vertical advection operator, dry air gas constant <span>$R_d$</span>, virtual temperature <span>$T_v$</span>, geopotential <span>$\Phi$</span>, pressure <span>$p$</span>, thermodynamic <span>$\kappa = R\_d/c_p$</span> with <span>$c_p$</span> the heat capacity at constant pressure. Horizontal hyper diffusion of the form <span>$(-1)^{n+1}\nu\nabla^{2n}$</span> with coefficient <span>$\nu$</span> and power <span>$n$</span>  is added for every variable that is advected, meaning <span>$\zeta, \mathcal{D}, T, q$</span>, but left out here for clarity, see <a href="../barotropic/#diffusion">Horizontal diffusion</a>.</p><p>The parameterizations for the tendencies of <span>$u,v,T,q$</span> from physical processes are denoted as <span>$\mathcal{P}_\mathbf{u} = (\mathcal{P}_u, \mathcal{P}_v), \mathcal{P}_T, \mathcal{P}_q$</span> and are further described in the corresponding sections, see <a href="../parameterizations/#parameterizations">Parameterizations</a>.</p><p>SpeedyWeather.jl implements a <code>PrimitiveWet</code> and a <code>PrimitiveDry</code> dynamical core. For a dry atmosphere, we have <span>$q = 0$</span> and the virtual temperature <span>$T_v = T$</span> equals the temperature (often called <em>absolute</em> to distinguish from the virtual temperature). The terms in the primitive equations and their discretizations are discussed in the following sections. </p><h2 id="Virtual-temperature"><a class="docs-heading-anchor" href="#Virtual-temperature">Virtual temperature</a><a id="Virtual-temperature-1"></a><a class="docs-heading-anchor-permalink" href="#Virtual-temperature" title="Permalink"></a></h2><div class="admonition is-info"><header class="admonition-header">In short: Virtual temperature</header><div class="admonition-body"><p>Virtual temperature is the temperature dry air would need to have to be as light as moist air. It is used in the dynamical core to include the effect of humidity on the density while replacing density through the ideal gas law with temperature.</p></div></div><p>We assume the atmosphere to be composed of two ideal gases: Dry air and water vapour. Given a specific humidity <span>$q$</span> both gases mix, their pressures <span>$p_d$</span>, <span>$p_w$</span> (<span>$d$</span> for dry, <span>$w$</span> for water vapour), and densities <span>$\rho_d, \rho_w$</span> add in a given air parcel that has temperature <span>$T$</span>. The ideal gas law then holds for both gases</p><p class="math-container">\[\begin{aligned}
p_d &amp;= \rho_d R_d T \\
p_w &amp;= \rho_w R_w T \\
\end{aligned}\]</p><p>with the respective specific gas constants <span>$R_d = R/m_d$</span> and <span>$R_w = R/m_w$</span> obtained from the univeral gas constant <span>$R$</span> divided by the molecular masses of the gas. The total pressure <span>$p$</span> in the air parcel is</p><p class="math-container">\[p = p_d + p_w = (\rho_d R_d + \rho_w R_w)T\]</p><p>We ultimately want to replace the density <span>$\rho = \rho_w + \rho_d$</span> in the dynamical core, using the ideal gas law, with the temperature <span>$T$</span>, so that we never have to calculate the density explicitly. However, in order to not deal with two densities (dry air and water vapour) we would like to replace temperature with a virtual temperature that includes the effect of humidity on the density. So, whereever we use the ideal gas law to replace density with temperature, we would use the virtual temperature, which is a function of the absolute temperature and specific humidity, instead. A higher specific humidity in an air parcel lowers  the density as water vapour is lighter than dry air. Consequently, the virtual temperature of moist air is higher than its absolute temperature because warmer air is lighter too at constant pressure. We therefore think of the virtual temperature as the temperature dry air would need to have to be as light as moist air.</p><p>Starting with the last equation, with some manipulation we can write the ideal gas law as total density <span>$rho$</span> times a gas constant times the virtual temperature that is supposed to be a function of absolute temperature, humidity and some constants</p><p class="math-container">\[p  = (\rho R_d + \rho_w (R_w - R_d)) T = \rho R_d (1 +
\frac{1 - \tfrac{R_d}{R_w}}{\tfrac{R_d}{R_w}} \frac{\rho_w}{\rho_w + \rho_d})T\]</p><p>Now we identify</p><p class="math-container">\[\mu = \frac{1 - \tfrac{R_d}{R_w}}{\tfrac{R_d}{R_w}}\]</p><p>as some constant that is positive for water vapour being lighter than dry air (<span>$\tfrac{R_d}{R_w} = \tfrac{m_w}{m_d} &lt; 1$</span>) and</p><p class="math-container">\[q = \frac{\rho_w}{\rho_w + \rho_d}\]</p><p>as the specific humidity. Given temperature <span>$T$</span> and specific humidity <span>$q$</span>, we can therefore calculate the virtual temperature <span>$T_v$</span> as</p><p class="math-container">\[T_v = (1 + \mu q)T\]</p><p>For completeness we want to mention here that the above product, because it is a  product of two variables <span>$q,T$</span> has to be computed in grid-point space, see [Spectral Transform]. To obtain an approximation to the virtual temperature in spectral space without expensive transforms one can linearize</p><p class="math-container">\[T_v = T + \mu q\bar{T}\]</p><p>With a global constant temperature <span>$\bar{T}$</span>, for example obtained from the <span>$l=m=0$</span> mode, <span>$\bar{T} = T_{0,0}\frac{1}{\sqrt{4\pi}}$</span> but depending on the normalization of the spherical harmonics that factor needs adjustment.</p><h2 id="Vertical-coordinates"><a class="docs-heading-anchor" href="#Vertical-coordinates">Vertical coordinates</a><a id="Vertical-coordinates-1"></a><a class="docs-heading-anchor-permalink" href="#Vertical-coordinates" title="Permalink"></a></h2><h3 id="General"><a class="docs-heading-anchor" href="#General">General</a><a id="General-1"></a><a class="docs-heading-anchor-permalink" href="#General" title="Permalink"></a></h3><p>Let <span>$\Psi(x,y,z,t)$</span> </p><p>SpeedyWeather.jl currently uses sigma coordinates for the vertical. </p><p class="math-container">\[\sigma = \frac{p}{p_s}\]</p><p class="math-container">\[p_k = \sigma_kp_s\]</p><p class="math-container">\[\Delta p_k = p_{k+1} - p_k = \Delta \sigma_k p_s\]</p><h2 id="Geopotential"><a class="docs-heading-anchor" href="#Geopotential">Geopotential</a><a id="Geopotential-1"></a><a class="docs-heading-anchor-permalink" href="#Geopotential" title="Permalink"></a></h2><p>In the hydrostatic approximation the vertical momentum equation becomes</p><p class="math-container">\[\frac{\partial p}{\partial z} = -\rho g,\]</p><p>meaning that the (negative) vertical pressure gradient is given by the density in  that layer times the gravitational acceleration. The heavier the fluid the more the pressure will increase below. Inserting the ideal gas law</p><p class="math-container">\[\frac{\partial gz}{\partial p} = -\frac{R_dT_v}{p},\]</p><p>with the geopotential <span>$\Phi = gz$</span> we can write this in terms of the logarithm of pressure</p><p class="math-container">\[\frac{\partial \Phi}{\partial \ln p} = -R_dT_v.\]</p><p>Note that we use the <a href="#Virtual-temperature">Virtual temperature</a> here as we replaced the density through the ideal gas law with temperature. Given a vertical temperature profile <span>$T_v$</span> and the (constant) surface geopotential <span>$\Phi_s = gz_s$</span> where <span>$z_s$</span> is the orography, we can integrate this equation from the surface to the top to obtain <span>$\Phi_k$</span> on every layer <span>$k$</span>. The surface is at <span>$k = N+\tfrac{1}{2}$</span> (see <a href="#Vertical-coordinates">Vertical coordinates</a>)  with <span>$N$</span> vertical levels. We can integrate the geopotential onto half levels as</p><p class="math-container">\[\Phi_{k-\tfrac{1}{2}} = \Phi_{k+\tfrac{1}{2}} + R_dT^v_k(\ln p_{k+1/2} - \ln p_{k-1/2})\]</p><h2 id="Surface-pressure-tendency"><a class="docs-heading-anchor" href="#Surface-pressure-tendency">Surface pressure tendency</a><a id="Surface-pressure-tendency-1"></a><a class="docs-heading-anchor-permalink" href="#Surface-pressure-tendency" title="Permalink"></a></h2><h2 id="Vertical-advection"><a class="docs-heading-anchor" href="#Vertical-advection">Vertical advection</a><a id="Vertical-advection-1"></a><a class="docs-heading-anchor-permalink" href="#Vertical-advection" title="Permalink"></a></h2><h2 id="Pressure-gradient-force"><a class="docs-heading-anchor" href="#Pressure-gradient-force">Pressure gradient force</a><a id="Pressure-gradient-force-1"></a><a class="docs-heading-anchor-permalink" href="#Pressure-gradient-force" title="Permalink"></a></h2><h2 id="Temperature-equation"><a class="docs-heading-anchor" href="#Temperature-equation">Temperature equation</a><a id="Temperature-equation-1"></a><a class="docs-heading-anchor-permalink" href="#Temperature-equation" title="Permalink"></a></h2><h2 id="implicit_primitive"><a class="docs-heading-anchor" href="#implicit_primitive">Semi-implicit time stepping</a><a id="implicit_primitive-1"></a><a class="docs-heading-anchor-permalink" href="#implicit_primitive" title="Permalink"></a></h2><h2 id="Horizontal-diffusion"><a class="docs-heading-anchor" href="#Horizontal-diffusion">Horizontal diffusion</a><a id="Horizontal-diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#Horizontal-diffusion" title="Permalink"></a></h2><h2 id="Algorithm"><a class="docs-heading-anchor" href="#Algorithm">Algorithm</a><a id="Algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Algorithm" title="Permalink"></a></h2><h2 id="Scaled-primitive-equations"><a class="docs-heading-anchor" href="#Scaled-primitive-equations">Scaled primitive equations</a><a id="Scaled-primitive-equations-1"></a><a class="docs-heading-anchor-permalink" href="#Scaled-primitive-equations" title="Permalink"></a></h2><h2 id="References"><a class="docs-heading-anchor" href="#References">References</a><a id="References-1"></a><a class="docs-heading-anchor-permalink" href="#References" title="Permalink"></a></h2><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a>Geophysical Fluid Dynamics Laboratory, <a href="https://www.gfdl.noaa.gov/idealized-models-with-spectral-dynamics/">Idealized models with spectral dynamics</a></li><li class="footnote" id="footnote-2"><a class="tag is-link" href="#citeref-2">2</a>Geophysical Fluid Dynamics Laboratory, <a href="https://www.gfdl.noaa.gov/wp-content/uploads/files/user_files/pjp/spectral_core.pdf">The Spectral Dynamical Core</a></li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../shallowwater/">« Shallow water model</a><a class="docs-footer-nextpage" href="../parameterizations/">Parameterizations »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Friday 16 June 2023 15:17">Friday 16 June 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
